BEGIN;
CREATE TABLE IF NOT EXISTS state_income_tax (
  state_code TEXT PRIMARY KEY,
  state_name TEXT,
  has_income_tax BOOLEAN,
  top_marginal_rate NUMERIC,
  brackets INTEGER,
  notes TEXT,
  fiscal_year INTEGER DEFAULT 2025
);

INSERT INTO state_income_tax (state_code, state_name, has_income_tax, top_marginal_rate, brackets, notes, fiscal_year) VALUES
('AL', 'Alabama', true, 5, 3, 'Deducts federal tax', 2025),
('AK', 'Alaska', false, 0, 0, 'No income tax', 2025),
('AZ', 'Arizona', true, 2.5, 1, 'Flat tax', 2025),
('AR', 'Arkansas', true, 3.9, 3, 'Graduated', 2025),
('CA', 'California', true, 13.3, 9, 'Includes 1% surcharge', 2025),
('CO', 'Colorado', true, 4.4, 1, 'Flat tax', 2025),
('CT', 'Connecticut', true, 6.99, 7, 'Graduated', 2025),
('DE', 'Delaware', true, 6.6, 6, 'Graduated', 2025),
('FL', 'Florida', false, 0, 0, 'No income tax', 2025),
('GA', 'Georgia', true, 5.49, 1, 'Flat tax starting 2024', 2025),
('HI', 'Hawaii', true, 11, 12, 'High top rate', 2025),
('ID', 'Idaho', true, 5.8, 1, 'Flat tax', 2025),
('IL', 'Illinois', true, 4.95, 1, 'Flat tax', 2025),
('IN', 'Indiana', true, 3.05, 1, 'Flat tax, decreasing', 2025),
('IA', 'Iowa', true, 5.7, 3, 'Transitioning to flat tax', 2025),
('KS', 'Kansas', true, 5.7, 3, 'Graduated', 2025),
('KY', 'Kentucky', true, 4, 1, 'Flat tax', 2025),
('LA', 'Louisiana', true, 4.25, 3, 'Graduated', 2025),
('ME', 'Maine', true, 7.15, 3, 'Graduated', 2025),
('MD', 'Maryland', true, 5.75, 8, 'Local taxes also apply', 2025),
('MA', 'Massachusetts', true, 9, 2, '5% base + 4% millionaires tax', 2025),
('MI', 'Michigan', true, 4.25, 1, 'Flat tax', 2025),
('MN', 'Minnesota', true, 9.85, 4, 'Graduated', 2025),
('MS', 'Mississippi', true, 4, 1, 'Flat tax', 2025),
('MO', 'Missouri', true, 4.8, 8, 'Graduated', 2025),
('MT', 'Montana', true, 5.9, 2, 'Graduated', 2025),
('NE', 'Nebraska', true, 5.84, 4, 'Decreasing gradually', 2025),
('NV', 'Nevada', false, 0, 0, 'No income tax', 2025),
('NH', 'New Hampshire', false, 3, 1, 'Interest and dividends only, phasing out', 2025),
('NJ', 'New Jersey', true, 10.75, 7, 'Graduated', 2025),
('NM', 'New Mexico', true, 5.9, 4, 'Graduated', 2025),
('NY', 'New York', true, 10.9, 9, 'Local taxes for NYC/Yonkers', 2025),
('NC', 'North Carolina', true, 4.5, 1, 'Flat tax', 2025),
('ND', 'North Dakota', true, 2.5, 3, 'Graduated', 2025),
('OH', 'Ohio', true, 3.5, 3, 'Graduated', 2025),
('OK', 'Oklahoma', true, 4.75, 6, 'Graduated', 2025),
('OR', 'Oregon', true, 9.9, 4, 'High rate', 2025),
('PA', 'Pennsylvania', true, 3.07, 1, 'Flat tax, local taxes apply', 2025),
('RI', 'Rhode Island', true, 5.99, 3, 'Graduated', 2025),
('SC', 'South Carolina', true, 6.4, 3, 'Graduated', 2025),
('SD', 'South Dakota', false, 0, 0, 'No income tax', 2025),
('TN', 'Tennessee', false, 0, 0, 'No income tax', 2025),
('TX', 'Texas', false, 0, 0, 'No income tax', 2025),
('UT', 'Utah', true, 4.65, 1, 'Flat tax', 2025),
('VT', 'Vermont', true, 8.75, 4, 'Graduated', 2025),
('VA', 'Virginia', true, 5.75, 4, 'Graduated', 2025),
('WA', 'Washington', false, 7, 1, 'Capital gains over 250k only, no wage tax', 2025),
('WV', 'West Virginia', true, 5.12, 5, 'Graduated', 2025),
('WI', 'Wisconsin', true, 7.65, 4, 'Graduated', 2025),
('WY', 'Wyoming', false, 0, 0, 'No income tax', 2025),
('DC', 'District of Columbia', true, 10.75, 7, 'Graduated', 2025)
ON CONFLICT (state_code) DO UPDATE SET
  has_income_tax = EXCLUDED.has_income_tax,
  top_marginal_rate = EXCLUDED.top_marginal_rate,
  brackets = EXCLUDED.brackets,
  notes = EXCLUDED.notes,
  fiscal_year = EXCLUDED.fiscal_year;
COMMIT;
BEGIN;
CREATE TABLE IF NOT EXISTS cms_hospitals (
  cms_id TEXT PRIMARY KEY,
  name TEXT,
  address TEXT,
  city TEXT,
  state TEXT,
  zip TEXT,
  county TEXT,
  phone TEXT,
  hospital_type TEXT,
  ownership TEXT,
  emergency_services BOOLEAN,
  overall_rating INTEGER,
  latitude NUMERIC,
  longitude NUMERIC
);

INSERT INTO cms_hospitals (cms_id, name, address, city, state, zip, county, phone, hospital_type, ownership, emergency_services, overall_rating, latitude, longitude) VALUES
('240010', 'Mayo Clinic Hospital Rochester', '201 W Center St', 'Rochester', 'MN', '55902', 'Olmsted', '(507) 284-2511', 'Acute Care Hospitals', 'Voluntary non-profit - Private', true, 5, 44.0223, -92.4665),
('360180', 'Cleveland Clinic', '9500 Euclid Ave', 'Cleveland', 'OH', '44195', 'Cuyahoga', '(216) 444-2200', 'Acute Care Hospitals', 'Voluntary non-profit - Private', true, 5, 41.5034, -81.6206),
('220071', 'Massachusetts General Hospital', '55 Fruit St', 'Boston', 'MA', '02114', 'Suffolk', '(617) 726-2000', 'Acute Care Hospitals', 'Voluntary non-profit - Private', true, 5, 42.3626, -71.0694),
('210009', 'Johns Hopkins Hospital', '1800 Orleans St', 'Baltimore', 'MD', '21287', 'Baltimore City', '(410) 955-5000', 'Acute Care Hospitals', 'Voluntary non-profit - Private', true, 5, 39.2973, -76.5902),
('050136', 'UCLA Medical Center', '757 Westwood Plaza', 'Los Angeles', 'CA', '90095', 'Los Angeles', '(310) 825-9111', 'Acute Care Hospitals', 'Government - State', true, 4, 34.0664, -118.4447),
('050441', 'Stanford Hospital', '300 Pasteur Dr', 'Stanford', 'CA', '94305', 'Santa Clara', '(650) 723-4000', 'Acute Care Hospitals', 'Voluntary non-profit - Other', true, 5, 37.4334, -122.1763),
('330214', 'New York-Presbyterian Hospital', '525 E 68th St', 'New York', 'NY', '10065', 'New York', '(212) 746-5454', 'Acute Care Hospitals', 'Voluntary non-profit - Private', true, 4, 40.7645, -73.9531),
('390164', 'Hospital of the University of Pennsylvania', '3400 Spruce St', 'Philadelphia', 'PA', '19104', 'Philadelphia', '(215) 662-4000', 'Acute Care Hospitals', 'Voluntary non-profit - Private', true, 4, 39.9496, -75.1936),
('140088', 'Northwestern Memorial Hospital', '251 E Huron St', 'Chicago', 'IL', '60611', 'Cook', '(312) 926-2000', 'Acute Care Hospitals', 'Voluntary non-profit - Private', true, 5, 41.8953, -87.6202),
('050100', 'UCSF Medical Center', '505 Parnassus Ave', 'San Francisco', 'CA', '94143', 'San Francisco', '(415) 476-1000', 'Acute Care Hospitals', 'Government - State', true, 4, 37.7629, -122.458),
('450054', 'Houston Methodist Hospital', '6565 Fannin St', 'Houston', 'TX', '77030', 'Harris', '(713) 790-3311', 'Acute Care Hospitals', 'Voluntary non-profit - Private', true, 5, 29.7118, -95.3985),
('060014', 'UCHealth University of Colorado Hospital', '12605 E 16th Ave', 'Aurora', 'CO', '80045', 'Adams', '(720) 848-0000', 'Acute Care Hospitals', 'Voluntary non-profit - Private', true, 5, 39.7424, -104.8368),
('330101', 'Mount Sinai Hospital', '1 Gustave L Levy Pl', 'New York', 'NY', '10029', 'New York', '(212) 241-6500', 'Acute Care Hospitals', 'Voluntary non-profit - Private', true, 4, 40.7896, -73.9538),
('230046', 'University of Michigan Hospitals', '1500 E Medical Center Dr', 'Ann Arbor', 'MI', '48109', 'Washtenaw', '(734) 936-4000', 'Acute Care Hospitals', 'Government - State', true, 5, 42.2829, -83.7275),
('340061', 'Duke University Hospital', '2301 Erwin Rd', 'Durham', 'NC', '27710', 'Durham', '(919) 684-8111', 'Acute Care Hospitals', 'Voluntary non-profit - Private', true, 4, 36.0076, -78.9378),
('050117', 'Cedars-Sinai Medical Center', '8700 Beverly Blvd', 'Los Angeles', 'CA', '90048', 'Los Angeles', '(310) 423-3277', 'Acute Care Hospitals', 'Voluntary non-profit - Private', true, 4, 34.0754, -118.3804),
('100007', 'UF Health Shands Hospital', '1600 SW Archer Rd', 'Gainesville', 'FL', '32608', 'Alachua', '(352) 265-0111', 'Acute Care Hospitals', 'Voluntary non-profit - Private', true, 4, 29.6397, -82.3421),
('380026', 'OHSU Hospital', '3181 SW Sam Jackson Park Rd', 'Portland', 'OR', '97239', 'Multnomah', '(503) 494-8311', 'Acute Care Hospitals', 'Government - State', true, 4, 45.4988, -122.6865),
('500008', 'University of Washington Medical Center', '1959 NE Pacific St', 'Seattle', 'WA', '98195', 'King', '(206) 598-3300', 'Acute Care Hospitals', 'Government - State', true, 4, 47.6496, -122.3082),
('440039', 'Vanderbilt University Medical Center', '1211 Medical Center Dr', 'Nashville', 'TN', '37232', 'Davidson', '(615) 322-5000', 'Acute Care Hospitals', 'Voluntary non-profit - Private', true, 4, 36.1408, -86.8016)
ON CONFLICT (cms_id) DO UPDATE SET
  name = EXCLUDED.name,
  address = EXCLUDED.address,
  city = EXCLUDED.city,
  state = EXCLUDED.state,
  zip = EXCLUDED.zip,
  county = EXCLUDED.county,
  phone = EXCLUDED.phone,
  hospital_type = EXCLUDED.hospital_type,
  ownership = EXCLUDED.ownership,
  emergency_services = EXCLUDED.emergency_services,
  overall_rating = EXCLUDED.overall_rating,
  latitude = EXCLUDED.latitude,
  longitude = EXCLUDED.longitude;
COMMIT;
BEGIN;
CREATE TABLE IF NOT EXISTS hospital_emr (
  cms_id TEXT REFERENCES cms_hospitals(cms_id),
  emr_vendor TEXT,
  emr_product TEXT,
  go_live_year INTEGER,
  source TEXT,
  confidence TEXT CHECK (confidence IN ('confirmed', 'likely', 'unverified')),
  PRIMARY KEY (cms_id)
);

INSERT INTO hospital_emr (cms_id, emr_vendor, emr_product, go_live_year, source, confidence) VALUES
('240010', 'Epic', 'EpicCare', 2018, 'KLAS', 'confirmed'),
('360180', 'Epic', 'EpicCare', 2005, 'Press Release', 'confirmed'),
('220071', 'Epic', 'EpicCare', 2015, 'Press Release', 'confirmed'),
('210009', 'Epic', 'EpicCare', 2013, 'Press Release', 'confirmed'),
('050136', 'Epic', 'EpicCare', 2013, 'Press Release', 'confirmed'),
('050441', 'Epic', 'EpicCare', 2008, 'KLAS', 'confirmed'),
('330214', 'Epic', 'EpicCare', 2020, 'Press Release', 'confirmed'),
('390164', 'Epic', 'EpicCare', 2008, 'KLAS', 'confirmed'),
('140088', 'Epic', 'EpicCare', 2018, 'Self-reported', 'confirmed'),
('050100', 'Epic', 'APeX', 2012, 'Self-reported', 'confirmed'),
('450054', 'Epic', 'EpicCare', 2016, 'Press Release', 'confirmed'),
('060014', 'Epic', 'EpicCare', 2011, 'KLAS', 'confirmed'),
('330101', 'Epic', 'EpicCare', 2016, 'KLAS', 'confirmed'),
('230046', 'Epic', 'MiChart', 2012, 'Self-reported', 'confirmed'),
('340061', 'Epic', 'Maestro Care', 2014, 'Self-reported', 'confirmed'),
('050117', 'Epic', 'CS-Link', 2012, 'Self-reported', 'confirmed'),
('100007', 'Epic', 'EpicCare', 2011, 'Press Release', 'confirmed'),
('380026', 'Epic', 'Epic OHSU', 2006, 'Self-reported', 'confirmed'),
('500008', 'Epic', 'EpicCare', 2021, 'Press Release', 'confirmed'),
('440039', 'Epic', 'eStar', 2017, 'Press Release', 'confirmed')
ON CONFLICT (cms_id) DO UPDATE SET
  emr_vendor = EXCLUDED.emr_vendor,
  emr_product = EXCLUDED.emr_product,
  go_live_year = EXCLUDED.go_live_year,
  source = EXCLUDED.source,
  confidence = EXCLUDED.confidence;
COMMIT;
BEGIN;
CREATE TABLE IF NOT EXISTS hud_fmr (
  fips_code TEXT PRIMARY KEY,
  state TEXT,
  county TEXT,
  metro_area TEXT,
  fmr_studio INTEGER,
  fmr_1br INTEGER,
  fmr_2br INTEGER,
  fiscal_year INTEGER DEFAULT 2025
);

INSERT INTO hud_fmr (fips_code, state, county, metro_area, fmr_studio, fmr_1br, fmr_2br, fiscal_year) VALUES
('06037', 'CA', 'Los Angeles County', 'Los Angeles-Long Beach-Glendale, CA HUD Metro FMR Area', 1714, 1957, 2470, 2025),
('17031', 'IL', 'Cook County', 'Chicago-Joliet-Naperville, IL HUD Metro FMR Area', 1391, 1533, 1774, 2025),
('48201', 'TX', 'Harris County', 'Houston-The Woodlands-Sugar Land, TX HUD Metro FMR Area', 1118, 1215, 1445, 2025),
('04013', 'AZ', 'Maricopa County', 'Phoenix-Mesa-Scottsdale, AZ MSA', 1398, 1526, 1815, 2025),
('06073', 'CA', 'San Diego County', 'San Diego-Carlsbad, CA MSA', 1980, 2196, 2843, 2025),
('06059', 'CA', 'Orange County', 'Santa Ana-Anaheim-Irvine, CA HUD Metro FMR Area', 2167, 2362, 2865, 2025),
('12086', 'FL', 'Miami-Dade County', 'Miami-Miami Beach-Kendall, FL HUD Metro FMR Area', 1690, 1888, 2275, 2025),
('48113', 'TX', 'Dallas County', 'Dallas, TX HUD Metro FMR Area', 1251, 1374, 1636, 2025),
('36047', 'NY', 'Kings County', 'New York, NY HUD Metro FMR Area', 2420, 2516, 2862, 2025),
('53033', 'WA', 'King County', 'Seattle-Bellevue, WA HUD Metro FMR Area', 1837, 1957, 2334, 2025),
('32003', 'NV', 'Clark County', 'Las Vegas-Henderson-Paradise, NV MSA', 1176, 1326, 1572, 2025),
('36081', 'NY', 'Queens County', 'New York, NY HUD Metro FMR Area', 2420, 2516, 2862, 2025),
('48439', 'TX', 'Tarrant County', 'Fort Worth-Arlington, TX HUD Metro FMR Area', 1243, 1332, 1599, 2025),
('12011', 'FL', 'Broward County', 'Fort Lauderdale, FL HUD Metro FMR Area', 1515, 1690, 2057, 2025),
('36061', 'NY', 'New York County', 'New York, NY HUD Metro FMR Area', 2420, 2516, 2862, 2025),
('26163', 'MI', 'Wayne County', 'Detroit-Warren-Livonia, MI HUD Metro FMR Area', 878, 1017, 1251, 2025),
('12099', 'FL', 'Palm Beach County', 'West Palm Beach-Boca Raton, FL HUD Metro FMR Area', 1551, 1735, 2137, 2025),
('42101', 'PA', 'Philadelphia County', 'Philadelphia-Camden-Wilmington, PA-NJ-DE-MD MSA', 1146, 1279, 1547, 2025),
('24033', 'MD', 'Prince George''s County', 'Washington-Arlington-Alexandria, DC-VA-MD HUD Metro FMR Area', 1655, 1734, 1968, 2025),
('06001', 'CA', 'Alameda County', 'Oakland-Fremont, CA HUD Metro FMR Area', 1888, 2099, 2552, 2025),
('13121', 'GA', 'Fulton County', 'Atlanta-Sandy Springs-Roswell, GA HUD Metro FMR Area', 1476, 1555, 1785, 2025),
('06085', 'CA', 'Santa Clara County', 'San Jose-Sunnyvale-Santa Clara, CA HUD Metro FMR Area', 2419, 2616, 3042, 2025),
('36005', 'NY', 'Bronx County', 'New York, NY HUD Metro FMR Area', 2420, 2516, 2862, 2025),
('48029', 'TX', 'Bexar County', 'San Antonio-New Braunfels, TX HUD Metro FMR Area', 1024, 1121, 1339, 2025)
ON CONFLICT (fips_code) DO UPDATE SET
  state = EXCLUDED.state,
  county = EXCLUDED.county,
  metro_area = EXCLUDED.metro_area,
  fmr_studio = EXCLUDED.fmr_studio,
  fmr_1br = EXCLUDED.fmr_1br,
  fmr_2br = EXCLUDED.fmr_2br,
  fiscal_year = EXCLUDED.fiscal_year;
COMMIT;
