BEGIN;
CREATE TABLE IF NOT EXISTS state_income_tax (
  state_code TEXT PRIMARY KEY,
  state_name TEXT,
  has_income_tax BOOLEAN,
  top_marginal_rate NUMERIC,
  brackets INTEGER,
  notes TEXT,
  fiscal_year INTEGER DEFAULT 2025
);

INSERT INTO state_income_tax (state_code, state_name, has_income_tax, top_marginal_rate, brackets, notes, fiscal_year) VALUES
('AL', 'Alabama', true, 5, 3, 'Deducts federal tax', 2025),
('AK', 'Alaska', false, 0, 0, 'No income tax', 2025),
('AZ', 'Arizona', true, 2.5, 1, 'Flat tax', 2025),
('AR', 'Arkansas', true, 3.9, 3, 'Graduated', 2025),
('CA', 'California', true, 13.3, 9, 'Includes 1% surcharge', 2025),
('CO', 'Colorado', true, 4.4, 1, 'Flat tax', 2025),
('CT', 'Connecticut', true, 6.99, 7, 'Graduated', 2025),
('DE', 'Delaware', true, 6.6, 6, 'Graduated', 2025),
('FL', 'Florida', false, 0, 0, 'No income tax', 2025),
('GA', 'Georgia', true, 5.49, 1, 'Flat tax starting 2024', 2025),
('HI', 'Hawaii', true, 11, 12, 'High top rate', 2025),
('ID', 'Idaho', true, 5.8, 1, 'Flat tax', 2025),
('IL', 'Illinois', true, 4.95, 1, 'Flat tax', 2025),
('IN', 'Indiana', true, 3.05, 1, 'Flat tax, decreasing', 2025),
('IA', 'Iowa', true, 5.7, 3, 'Transitioning to flat tax', 2025),
('KS', 'Kansas', true, 5.7, 3, 'Graduated', 2025),
('KY', 'Kentucky', true, 4, 1, 'Flat tax', 2025),
('LA', 'Louisiana', true, 4.25, 3, 'Graduated', 2025),
('ME', 'Maine', true, 7.15, 3, 'Graduated', 2025),
('MD', 'Maryland', true, 5.75, 8, 'Local taxes also apply', 2025),
('MA', 'Massachusetts', true, 9, 2, '5% base + 4% millionaires tax', 2025),
('MI', 'Michigan', true, 4.25, 1, 'Flat tax', 2025),
('MN', 'Minnesota', true, 9.85, 4, 'Graduated', 2025),
('MS', 'Mississippi', true, 4, 1, 'Flat tax', 2025),
('MO', 'Missouri', true, 4.8, 8, 'Graduated', 2025),
('MT', 'Montana', true, 5.9, 2, 'Graduated', 2025),
('NE', 'Nebraska', true, 5.84, 4, 'Decreasing gradually', 2025),
('NV', 'Nevada', false, 0, 0, 'No income tax', 2025),
('NH', 'New Hampshire', false, 3, 1, 'Interest and dividends only, phasing out', 2025),
('NJ', 'New Jersey', true, 10.75, 7, 'Graduated', 2025),
('NM', 'New Mexico', true, 5.9, 4, 'Graduated', 2025),
('NY', 'New York', true, 10.9, 9, 'Local taxes for NYC/Yonkers', 2025),
('NC', 'North Carolina', true, 4.5, 1, 'Flat tax', 2025),
('ND', 'North Dakota', true, 2.5, 3, 'Graduated', 2025),
('OH', 'Ohio', true, 3.5, 3, 'Graduated', 2025),
('OK', 'Oklahoma', true, 4.75, 6, 'Graduated', 2025),
('OR', 'Oregon', true, 9.9, 4, 'High rate', 2025),
('PA', 'Pennsylvania', true, 3.07, 1, 'Flat tax, local taxes apply', 2025),
('RI', 'Rhode Island', true, 5.99, 3, 'Graduated', 2025),
('SC', 'South Carolina', true, 6.4, 3, 'Graduated', 2025),
('SD', 'South Dakota', false, 0, 0, 'No income tax', 2025),
('TN', 'Tennessee', false, 0, 0, 'No income tax', 2025),
('TX', 'Texas', false, 0, 0, 'No income tax', 2025),
('UT', 'Utah', true, 4.65, 1, 'Flat tax', 2025),
('VT', 'Vermont', true, 8.75, 4, 'Graduated', 2025),
('VA', 'Virginia', true, 5.75, 4, 'Graduated', 2025),
('WA', 'Washington', false, 7, 1, 'Capital gains over 250k only, no wage tax', 2025),
('WV', 'West Virginia', true, 5.12, 5, 'Graduated', 2025),
('WI', 'Wisconsin', true, 7.65, 4, 'Graduated', 2025),
('WY', 'Wyoming', false, 0, 0, 'No income tax', 2025),
('DC', 'District of Columbia', true, 10.75, 7, 'Graduated', 2025)
ON CONFLICT (state_code) DO UPDATE SET
  has_income_tax = EXCLUDED.has_income_tax,
  top_marginal_rate = EXCLUDED.top_marginal_rate,
  brackets = EXCLUDED.brackets,
  notes = EXCLUDED.notes,
  fiscal_year = EXCLUDED.fiscal_year;
COMMIT;
